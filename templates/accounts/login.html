{% extends "master/base.html" %}
{% load static %}
{% block content %}

<section class="section-content padding-y" style="min-height: 84vh">
  <div class="card mx-auto" style="max-width: 420px; margin-top: 100px">
    <div class="card-body">
      <header class="mb-4 text-center">
        <h4 class="card-title">
          <i class="fa fa-sign-in-alt text-primary"></i> Welcome Back
        </h4>
        <p class="text-muted">Sign in to your account</p>
      </header>

      <form action="{% url 'login' %}" method="POST" id="login-form">
        {% csrf_token %}

        {% if error %}
          <div class="alert alert-danger">
            <i class="fa fa-exclamation-triangle"></i> {{ error }}
          </div>
        {% endif %}

        <div class="form-group">
          <label for="username">
            <i class="fa fa-user text-muted"></i> Username or Email
          </label>
          <input
            type="text"
            name="username"
            id="username"
            class="form-control"
            placeholder="Enter username or email"
            value="{{ identifier_value|default:'' }}"
            autocomplete="username"
            required
          />
        </div>

        <div class="form-group">
          <label for="password">
            <i class="fa fa-lock text-muted"></i> Password
          </label>
          <div class="input-group">
            <input
              type="password"
              name="password"
              id="password"
              class="form-control"
              placeholder="Enter password"
              autocomplete="current-password"
              required
            />
            <div class="input-group-append">
              <button type="button" class="btn btn-outline-secondary" id="toggle-password">
                <i class="fa fa-eye"></i>
              </button>
            </div>
          </div>
        </div>

        <div class="form-group">
          <div class="d-flex justify-content-between align-items-center">
            <div class="custom-control custom-checkbox">
              <input type="checkbox" class="custom-control-input" id="remember-me" name="remember_me">
              <label class="custom-control-label" for="remember-me">Remember me</label>
            </div>

            <a href="{% url 'password_reset' %}" class="text-primary">Forgot password?</a>
          </div>

          {% if show_resend_verification %}
            <div class="mt-3">
              <div class="alert alert-warning mb-2">
                <strong>Email not verified.</strong> Resend verification email:
              </div>

              <form method="POST" action="{% url 'resend_verification_email_public' %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{% url 'login' %}">
                <input type="hidden" name="email" value="{{ resend_email }}">

                <button type="submit" class="btn btn-outline-secondary btn-block">
                  <i class="fa fa-envelope"></i> Resend verification email
                </button>
              </form>
            </div>
          {% endif %}
        </div>

        <button type="submit" class="btn btn-primary btn-block btn-lg" id="login-btn">
          <i class="fa fa-sign-in-alt"></i> Sign In
        </button>

        <div class="text-center mt-3">
          <small class="text-muted">
            <i class="fa fa-shield-alt text-success"></i> Your data is secure with us
          </small>
        </div>
      </form>
    </div>
  </div>

  <p class="text-center mt-4">
    Don't have an account?
    <a href="{% url 'register' %}" class="font-weight-bold text-danger">Create Account</a>
  </p>
  <br /><br />
</section>

<style>
.section-content .card { border: none; box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15); border-radius: 15px; overflow: hidden; }
.card-body { padding: 2.5rem; }
.section-content .form-control { border-radius: 8px; border: 2px solid #e9ecef; padding: 12px 15px; font-size: 14px; transition: all 0.3s ease; }
.form-control:focus { border-color: #0a2558; box-shadow: 0 0 0 0.2rem rgba(10, 37, 88, 0.25); transform: translateY(-1px); }
.form-control.is-valid { border-color: #28a745; }
.form-control.is-invalid { border-color: #e63946; }
.section-content .btn-primary { background: linear-gradient(135deg, #0a2558 0%, #061838 100%); border: none; border-radius: 10px; padding: 15px; font-weight: 600; font-size: 16px; transition: all 0.3s ease; }
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(10, 37, 88, 0.3); }
.btn-primary:disabled { opacity: 0.6; transform: none; box-shadow: none; }
.btn-outline-secondary { border-color: #e9ecef; }
.btn-outline-secondary:hover { background-color: #f8f9fa; border-color: #0a2558; }
.input-group .form-control { border-radius: 8px 0 0 8px; }
.input-group-append .btn { border-left: none; border-radius: 0 8px 8px 0; }
.alert { border-radius: 10px; border: none; border-left: 5px solid #e63946; }
.custom-control-input:checked ~ .custom-control-label::before { background-color: #0a2558; border-color: #0a2558; }
label { font-weight: 600; color: #495057; margin-bottom: 8px; }
.text-primary { color: #0a2558 !important; text-decoration: none; font-weight: 600; }
.text-primary:hover { text-decoration: underline; }
@media (max-width: 768px) { .card-body { padding: 1.5rem; } .form-control { font-size: 16px; } }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('login-form');
    const loginBtn = document.getElementById('login-btn');
    const passwordInput = document.getElementById('password');
    const togglePasswordBtn = document.getElementById('toggle-password');
    const usernameInput = document.getElementById('username');

    form.addEventListener('submit', function(e) {
        if (!usernameInput.value.trim() || !passwordInput.value) {
            e.preventDefault();
            alert('Please enter both username/email and password');
            return;
        }
        loginBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Signing In...';
        loginBtn.disabled = true;
    });

    togglePasswordBtn.addEventListener('click', function() {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);

        const icon = this.querySelector('i');
        if (type === 'password') {
            icon.classList.remove('fa-eye-slash');
            icon.classList.add('fa-eye');
        } else {
            icon.classList.remove('fa-eye');
            icon.classList.add('fa-eye-slash');
        }
    });
});
</script>

{% endblock %}