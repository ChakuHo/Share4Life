{% load static %}

{% if messages %}
<div id="messages-container" class="messages-container">
  <!-- Clear All Button -->
  {% if messages|length > 2 %}
  <div class="text-right mb-2">
    <button type="button" class="btn btn-sm btn-outline-danger clear-all-messages" onclick="clearAllMessages()">
      <i class="fa fa-trash mr-1"></i>Clear All ({{ messages|length }})
    </button>
  </div>
  {% endif %}

  <!-- Messages List -->
  {% for message in messages %}
  <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show message-item" 
       role="alert">
    
    <i class="fa fa-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' or message.tags == 'danger' %}exclamation-triangle{% else %}info-circle{% endif %} mr-2"></i>
    
    <span class="message-text">{{ message }}</span>
    
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
      <span aria-hidden="true">&times;</span>
    </button>
    
    <!-- Timer -->
    <div class="message-timer" style="display: none;">
      <div class="timer-bar"></div>
    </div>
  </div>
  {% endfor %}
</div>

<style>
/* Keeping your exact CSS for the Toasts */
.messages-container {
  position: fixed;
  top: 100px; /* Adjusted for sticky header */
  right: 20px;
  width: 350px;
  z-index: 9999;
}
.message-item {
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  border: none;
  animation: slideIn 0.3s ease-out;
}
.message-timer {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: rgba(255,255,255,0.3);
}
.timer-bar {
  height: 100%;
  background: rgba(255,255,255,0.8);
  width: 0%;
}
@keyframes slideIn {
  from { transform: translateX(100%); opacity: 0; }
  to { transform: translateX(0); opacity: 1; }
}
.alert-success { background: linear-gradient(45deg, #28a745, #218838); color: white; }
.alert-danger { background: linear-gradient(45deg, #dc3545, #c82333); color: white; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const messages = document.querySelectorAll('.message-item');
    
    messages.forEach((message) => {
        const isError = message.classList.contains('alert-danger');
        
        if (!isError) {
            const timer = message.querySelector('.message-timer');
            const timerBar = message.querySelector('.timer-bar');
            
            if (timer && timerBar) {
                timer.style.display = 'block';
                timerBar.style.transition = 'width 5s linear';
                setTimeout(() => { timerBar.style.width = '100%'; }, 100);
                setTimeout(() => { message.remove(); }, 5000);
            }
        }
    });
});

function clearAllMessages() {
    document.querySelectorAll('.message-item').forEach(el => el.remove());
    // NOTE: AJAX call removed temporarily until backend view is created
    // fetch('/clear-messages/')... 
}
</script>
{% endif %}