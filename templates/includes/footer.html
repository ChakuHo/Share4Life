{% load static %}
{% now "Y" as current_year %}

{% url 'home' as home_url %}
{% url 'register' as register_url %}
{% url 'profile_edit' as profile_edit_url %}
{% url 'kyc_submit' as kyc_submit_url %}

{% url 'public_dashboard' as blood_feed_url %}
{% url 'blood_campaigns' as blood_campaigns_url %}
{% url 'emergency_request' as emergency_request_url %}

{% url 'org_register' as org_register_url %}
{% url 'org_portal' as org_portal_url %}
{% url 'org_pending' as org_pending_url %}
{% url 'institutions_home' as institutions_home_url %}
{% url 'institutions_directory' as institutions_directory_url %}

<footer class="s4l-footer">

  <!-- CTA STRIP (compact) -->
  <div class="s4l-footer-cta">
    <div class="container d-flex flex-wrap justify-content-between align-items-center py-2">
      <div class="text-white pr-3">
        {% if user.is_authenticated %}
          <div class="font-weight-bold s4l-cta-title">Keep your account ready for emergencies</div>
          <div class="s4l-cta-sub">Complete profile & KYC for faster matching.</div>
        {% else %}
          <div class="font-weight-bold s4l-cta-title">Join the Lifesavers Community</div>
          <div class="s4l-cta-sub">Register today to become a donor and save lives in your area.</div>
        {% endif %}
      </div>

      <div class="mt-2 mt-md-0">
        {% if user.is_authenticated %}
          {% if not user.is_verified and kyc_submit_url %}
            <a href="{{ kyc_submit_url }}" class="btn btn-light font-weight-bold s4l-cta-btn">
              <i class="fa fa-id-card mr-1"></i> Complete KYC
            </a>
          {% elif profile_edit_url %}
            <a href="{{ profile_edit_url }}" class="btn btn-light font-weight-bold s4l-cta-btn">
              <i class="fa fa-edit mr-1"></i> Update Profile
            </a>
          {% endif %}
        {% else %}
          {% if register_url %}
            <a href="{{ register_url }}" class="btn btn-light font-weight-bold s4l-cta-btn">
              <i class="fa fa-user-plus mr-1"></i> Register
            </a>
          {% endif %}
        {% endif %}
      </div>
    </div>
  </div>

  <!-- MAIN FOOTER -->
  <div class="s4l-footer-main">
    <div class="container s4l-footer-pad">
      <div class="row">

        <!-- Brand + Social -->
        <div class="col-lg-4 col-md-6 mb-4">
          <a href="{{ home_url|default:'/' }}" class="d-inline-flex align-items-center mb-2 s4l-footer-brand">
            {% if site_settings and site_settings.site_logo %}
              <img src="{{ site_settings.site_logo.url }}"
                   alt="{{ site_settings.site_name|default:'Share4Life' }}"
                   class="s4l-footer-logo">
            {% else %}
              <div class="text-white s4l-footer-brandtext">
                <i class="fa fa-heartbeat text-danger mr-2"></i>Share<span class="text-danger">4</span>Life
              </div>
            {% endif %}
          </a>

          <p class="mb-3 s4l-footer-desc">
            {{ site_settings.footer_text|default:"Saving Lives, One Donation at a Time." }}
          </p>

          <div class="s4l-footer-title mt-3">Follow Us</div>
          <div class="s4l-social">
            {% if site_settings.facebook_url %}
              <a class="s4l-social-link" href="{{ site_settings.facebook_url }}" target="_blank" rel="noopener" aria-label="Facebook">
                <i class="fab fa-facebook-f"></i>
              </a>
            {% endif %}
            {% if site_settings.instagram_url %}
              <a class="s4l-social-link" href="{{ site_settings.instagram_url }}" target="_blank" rel="noopener" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
              </a>
            {% endif %}
            {% if site_settings.twitter_url %}
              <a class="s4l-social-link" href="{{ site_settings.twitter_url }}" target="_blank" rel="noopener" aria-label="X">
                <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true" focusable="false"
                     style="display:block; fill: currentColor;">
                  <path d="M18.901 1.153h3.68l-8.03 9.175L24 22.846h-7.406l-5.8-7.584-6.64 7.584H.47l8.59-9.82L0 1.153h7.594l5.243 6.932 6.064-6.932zm-1.29 19.493h2.04L6.48 3.261H4.292L17.61 20.646z"/>
                </svg>
              </a>
            {% endif %}
          </div>

          <div class="small mt-3 s4l-footer-bullets">
            <div class="mb-2"><i class="fa fa-shield-alt mr-2"></i>Secure medical data handling</div>
            <div><i class="fa fa-bolt mr-2"></i>Fast emergency matching & alerts</div>
          </div>
        </div>

        <!-- Quick Links -->
        <div class="col-lg-2 col-md-6 mb-4">
          <div class="s4l-footer-title">Quick Links</div>
          <ul class="s4l-footer-links">
            <li><a href="{{ home_url|default:'/' }}">Home</a></li>
            <li><a href="{{ blood_feed_url|default:'#' }}">Find Blood</a></li>
            <li><a href="{{ blood_campaigns_url|default:'#' }}">Donation Camps</a></li>
            <li><a href="{{ emergency_request_url|default:'#' }}">Request Blood</a></li>
          </ul>

          <div class="s4l-footer-title mt-3">Help</div>
          <ul class="s4l-footer-links">
            <li><a href="#" data-toggle="modal" data-target="#faqModal">FAQ</a></li>
            <!-- <li><a href="#" data-toggle="modal" data-target="#faqModal">Eligibility (90-day rule)</a></li> -->
            <!-- <li><a href="#" data-toggle="modal" data-target="#faqModal">Verification & Safety</a></li> -->
          </ul>
        </div>

        <!-- Institutions -->
        <div class="col-lg-2 col-md-6 mb-4">
          <div class="s4l-footer-title">Institutions</div>
          <ul class="s4l-footer-links">
            <li><a href="{{ institutions_directory_url|default:'#' }}">Institutions Directory</a></li>

            {% if user.is_authenticated %}
              {% if org_membership %}
                <li><a href="{{ org_portal_url|default:'#' }}">Institution Portal</a></li>
              {% elif org_application %}
                <li><a href="{{ org_pending_url|default:'#' }}">Organization Status</a></li>
              {% else %}
                <li><a href="{{ org_register_url|default:'#' }}">Register Organization</a></li>
              {% endif %}
            {% else %}
              <li><a href="{{ institutions_home_url|default:'#' }}">Institutions Home</a></li>
              <li><a href="{{ org_register_url|default:'#' }}">Register (Login required)</a></li>
            {% endif %}
          </ul>
        </div>

        <!-- Contact -->
        <div class="col-lg-4 col-md-6 mb-4">
          <div class="s4l-footer-title">Contact</div>
          <div class="mb-2 s4l-footer-contact">
            <i class="fas fa-phone mr-2"></i>{{ site_settings.contact_phone|default:"+977-9800000000" }}
          </div>
          <div class="mb-2 s4l-footer-contact">
            <i class="fas fa-envelope mr-2"></i>{{ site_settings.contact_email|default:"support@share4life.com" }}
          </div>
          <div class="mb-3 s4l-footer-contact">
            <i class="fas fa-map-marker-alt mr-2"></i>{{ site_settings.address|default:"Kathmandu, Nepal" }}
          </div>

          <div class="small s4l-footer-hours">
            <div class="mb-1"><strong>Emergency:</strong> Call 102</div>
            <div><strong>Hours:</strong> 24/7 for urgent requests</div>
          </div>

          <div class="small mt-3 s4l-footer-disclaimer">
            <strong>Disclaimer:</strong> Share4Life is a coordination platform, not a medical provider.
            For critical emergencies call <strong>102</strong> immediately.
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- BOTTOM BAR -->
  <div class="s4l-footer-bottom">
    <div class="container py-3 d-flex flex-wrap justify-content-between align-items-center">
      <div class="mb-2 mb-md-0">
        &copy; {{ current_year }} {{ site_settings.site_name|default:"Share4Life" }}. All rights reserved.
      </div>
      <div class="s4l-footer-bottom-links">
        <a href="#" data-toggle="modal" data-target="#privacyModal">Privacy</a>
        <a href="#" data-toggle="modal" data-target="#termsModal" class="ml-3">Terms</a>
      </div>
    </div>
  </div>

</footer>

<!-- PRIVACY MODAL -->
<div class="modal fade" id="privacyModal" tabindex="-1" role="dialog" aria-labelledby="privacyTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content" style="border-radius:14px;">
      <div class="modal-header">
        <h5 class="modal-title" id="privacyTitle">Privacy Policy</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span>&times;</span></button>
      </div>
      <div class="modal-body">
        {% if site_settings.privacy_policy %}
          <div class="text-muted" style="white-space: pre-wrap;">{{ site_settings.privacy_policy }}</div>
        {% else %}
          <div class="text-muted">Privacy policy not set yet. Admin can add it from Site Settings.</div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- TERMS MODAL -->
<div class="modal fade" id="termsModal" tabindex="-1" role="dialog" aria-labelledby="termsTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content" style="border-radius:14px;">
      <div class="modal-header">
        <h5 class="modal-title" id="termsTitle">Terms of Service</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span>&times;</span></button>
      </div>
      <div class="modal-body">
        {% if site_settings.terms_of_service %}
          <div class="text-muted" style="white-space: pre-wrap;">{{ site_settings.terms_of_service }}</div>
        {% else %}
          <div class="text-muted">Terms not set yet. Admin can add it from Site Settings.</div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- FAQ MODAL -->
<div class="modal fade" id="faqModal" tabindex="-1" role="dialog" aria-labelledby="faqTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content" style="border-radius:14px;">
      <div class="modal-header">
        <h5 class="modal-title" id="faqTitle">FAQ</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span>&times;</span></button>
      </div>
      <div class="modal-body">
        {% if site_settings.footer_faq %}
          <div class="text-muted" style="white-space: pre-wrap;">{{ site_settings.footer_faq }}</div>
        {% else %}
          <div class="text-muted">
            FAQ not set yet. Admin can add it from Site Settings (footer_faq).
          </div>
        {% endif %}
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<style>
  .s4l-footer { margin-top: 40px; }

  .s4l-footer-cta { background: var(--secondary-color); }
  .s4l-cta-btn { color: var(--secondary-color) !important; }
  .s4l-cta-title { font-size: 16px; line-height: 1.2; }
  .s4l-cta-sub { opacity: .95; font-size: 13px; }

  .s4l-footer-main {
    background: linear-gradient(135deg, #1a3f87 0%, #60656e 100%);
    color: rgba(255,255,255,0.88);
  }
  .s4l-footer-pad{
    padding-top: 34px;
    padding-bottom: 22px;
  }

  .s4l-footer-brand { text-decoration:none; }
  .s4l-footer-logo{
    height: 44px;
    max-height: 44px;
    width: auto;
    max-width: 180px;
    object-fit: contain;
    display:block;
  }
  .s4l-footer-brandtext{ font-weight:900; font-size:20px; }

  .s4l-footer-desc{ opacity:.92; margin-bottom: 10px; }
  .s4l-footer-title { color:#fff; font-weight:800; margin-bottom: 10px; letter-spacing: .2px; }

  .s4l-footer-links { list-style:none; padding:0; margin:0; }
  .s4l-footer-links li { margin-bottom: 7px; }
  .s4l-footer-links a { color: rgba(255,255,255,0.82); text-decoration:none; }
  .s4l-footer-links a:hover { color:#fff; text-decoration: underline; }

  .s4l-footer-contact{ opacity:.92; }
  .s4l-footer-hours{ opacity:.85; }
  .s4l-footer-disclaimer{ opacity:.85; }

  .s4l-footer-bottom {
    background: #05122b;
    color: rgba(255,255,255,0.75);
  }
  .s4l-footer-bottom a { color: rgba(255,255,255,0.75); text-decoration:none; }
  .s4l-footer-bottom a:hover { color:#fff; text-decoration: underline; }

  .s4l-social { display:flex; flex-wrap:wrap; gap:10px; }
  .s4l-social-link{
    width: 34px; height: 34px;
    display:inline-flex; align-items:center; justify-content:center;
    border-radius: 999px;
    background: rgba(255,255,255,0.10);
    color: #fff;
    text-decoration: none;
    transition: transform .2s ease, background .2s ease;
  }
  .s4l-social-link:hover{
    background: rgba(255,255,255,0.18);
    transform: translateY(-2px);
    color:#fff;
    text-decoration:none;
  }

  @media (max-width: 575.98px){
    .s4l-footer-logo{ height: 38px; max-height: 38px; max-width: 160px; }
    .s4l-footer-pad{ padding-top: 26px; padding-bottom: 16px; }
  }
</style>