{% extends "master/base.html" %}
{% block content %}

<section class="section-content padding-y" style="min-height:84vh;">
  <div class="container">

    <div class="d-flex flex-wrap justify-content-between align-items-center mb-3">
      <div>
        <h3 class="mb-1">Blood Donation Camps</h3>
        <div class="text-muted">Upcoming and ongoing blood donation drives.</div>
      </div>

      <div class="d-flex flex-wrap" style="gap:.5rem;">
        {# Show create button only if user is approved org ADMIN #}
        {% if user.is_authenticated and org_membership and org_membership.role == "ADMIN" %}
          <a href="{% url 'org_campaign_create' %}" class="btn btn-danger">
            <i class="fa fa-plus"></i> Create Campaign
          </a>
        {% endif %}

        {# Helpful shortcut for any org member #}
        {% if user.is_authenticated and org_membership %}
          <a href="{% url 'org_portal' %}" class="btn btn-outline-secondary">
            <i class="fa fa-hospital"></i> Institution Portal
          </a>
        {% endif %}
      </div>
    </div>

    <div class="row">
      {% for c in campaigns %}
        <div class="col-md-6 col-lg-4">
          <div class="card mb-3 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex justify-content-between mb-2">
                <span class="badge badge-danger p-2">{{ c.organization.get_org_type_display }}</span>
                <small class="text-muted">{{ c.date|date:"Y-m-d" }}</small>
              </div>

              <h5 class="mb-1">{{ c.title }}</h5>
              <div class="text-muted small mb-2">
                By <strong>{{ c.organization.name }}</strong><br>
                Venue: {{ c.venue_name }}{% if c.city %}, {{ c.city }}{% endif %}
              </div>

              {% if c.description %}
                <p class="small mb-2">{{ c.description|truncatechars:120 }}</p>
              {% endif %}

              <div class="text-muted small">
                Target units: <strong>{{ c.target_units }}</strong>
                {% if c.blood_groups_needed %}
                  <br>Needed: {{ c.blood_groups_needed }}
                {% endif %}
              </div>

              <div class="mt-3 d-flex flex-wrap" style="gap:.5rem;">
                <a class="btn btn-sm btn-outline-primary" target="_blank" rel="noopener"
                   href="https://www.google.com/maps/search/?api=1&query={{ c.venue_name|urlencode }}%20{{ c.city|urlencode }}">
                  <i class="fa fa-map-marker-alt"></i> Map
                </a>
              </div>

            </div>
          </div>
        </div>
      {% empty %}
        <div class="col-12">
          <div class="alert alert-secondary">
            No upcoming campaigns right now. <br>
            Create One?
            {% if user.is_authenticated and org_membership and org_membership.role == "ADMIN" %}
              <!-- <div class="mt-2">
                <a href="{% url 'org_campaign_create' %}" class="btn btn-sm btn-danger">
                  <i class="fa fa-plus"></i> Create campaign
                </a>
              </div> -->
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>

  </div>
</section>

{% endblock %}